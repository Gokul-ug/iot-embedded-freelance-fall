<!DOCTYPE html>
<html>
<head><title>ESP32 File Upload</title></head>
<body>
  <h2>Upload File with Hash</h2>
  <form id="uploadForm">
    <input type="file" id="fileInput"><br><br>
    <input type="submit" value="Upload">
  </form>
  <p id="status"></p>

  <script>
    document.getElementById('uploadForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];
      if (!file) return alert("Choose a file!");

      const buffer = await file.arrayBuffer();
      const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

      const formData = new FormData();
      formData.append('file', new Blob([buffer]), file.name);
      formData.append('hash', hashHex);

      const res = await fetch('/upload', { method: 'POST', body: formData });
      const text = await res.text();
      document.getElementById('status').textContent = text;
    });
  </script>
</body>
</html>
